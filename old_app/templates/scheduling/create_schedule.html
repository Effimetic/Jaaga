{% extends "base.html" %}

{% block title %}{% if edit_mode %}Edit Schedule - Step 1{% else %}Create Schedule - Step 1{% endif %}{% endblock %}

{% block content %}
<!-- Edit mode variables -->
{% set edit_mode = edit_mode or false %}
{% set edit_schedule_id = edit_schedule_id or '' %}
{% set preloaded_date = preloaded_date or '' %}

<div class="mobile-app-container">
  <div class="page-header">
    <div class="header-content">
      <h4 class="page-title"><i class="fas fa-{% if edit_mode %}edit{% else %}calendar-plus{% endif %} me-2"></i>{% if edit_mode %}Edit Schedule{% else %}Create Schedule{% endif %}</h4>
      <p class="page-subtitle">{% if edit_mode %}Step 1 of 5 • Update date{% else %}Step 1 of 4 • Choose date{% endif %}</p>
                </div>
    <a href="{% if edit_mode %}{{ url_for('scheduling.view_schedule', schedule_id=edit_schedule_id) }}{% else %}{{ url_for('scheduling.schedules') }}{% endif %}" class="add-btn" title="{% if edit_mode %}Back to schedule{% else %}Back to schedules{% endif %}"><i class="fas fa-arrow-left"></i></a>
            </div>
            
  <div class="form-card">
                    <form id="dateForm">
      <div class="form-group">
        <label for="scheduleDate" class="form-label"><i class="fas fa-calendar me-2"></i>Schedule Date</label>
        <input type="date" class="form-input" id="scheduleDate" name="scheduleDate" 
               value="{{ preloaded_date or '' }}" required title="Schedule date">
        <small class="text-muted">{% if edit_mode %}Update the date for your schedule{% else %}Select a future date for your schedule{% endif %}</small>
                        </div>
      <button type="submit" class="submit-btn"><i class="fas fa-arrow-right me-2"></i>{% if edit_mode %}Continue to boat selection{% else %}Continue to boat selection{% endif %}</button>
      <a href="{% if edit_mode %}{{ url_for('scheduling.view_schedule', schedule_id=edit_schedule_id) }}{% else %}{{ url_for('scheduling.schedules') }}{% endif %}" class="cancel-link"><i class="fas fa-arrow-left me-2"></i>{% if edit_mode %}Back to schedule{% else %}Back to schedules{% endif %}</a>
                    </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Set minimum date to today
document.getElementById('scheduleDate').min = new Date().toISOString().split('T')[0];

// Handle form submission
document.getElementById('dateForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const scheduleDate = document.getElementById('scheduleDate').value;
    const button = document.querySelector('button[type="submit"]');
    const originalText = button.innerHTML;
    
    if (!scheduleDate) {
        showAlert('Please select a schedule date', 'warning');
        return;
    }
    
    // Check if date is in the future
    const selectedDate = new Date(scheduleDate);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    if (selectedDate < today) {
        showAlert('Schedule date must be in the future', 'warning');
        return;
    }
    
    showLoading(button);
    
    try {
        const response = await fetch('/schedules/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ schedule_date: scheduleDate })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert(data.message, 'success');
            setTimeout(() => {
                window.location.href = data.redirect;
            }, 1500);
        } else {
            showAlert(data.error || 'Failed to set schedule date', 'danger');
        }
    } catch (error) {
        showAlert('Network error. Please try again.', 'danger');
    } finally {
        hideLoading(button, originalText);
    }
});
</script>

<style>
  .mobile-app-container { max-width: 600px; margin: 0 auto; padding: 1rem; }
  .page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding: 1rem; background: #fff; border: 1px solid #e9ecef; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
  .header-content { flex: 1; }
  .page-title { margin: 0; font-size: 1.125rem; font-weight: 600; color: #212529; }
  .page-subtitle { margin: 0.25rem 0 0; color: #6c757d; font-size: 0.85rem; }
  .add-btn { width: 40px; height: 40px; background: #f1f3f5; color: #495057; display: inline-flex; align-items: center; justify-content: center; border-radius: 10px; text-decoration: none; }
  .form-card { background: #fff; border: 1px solid #e9ecef; border-radius: 16px; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
  .form-group { display: flex; flex-direction: column; gap: 0.4rem; margin-bottom: 1rem; }
  .form-label { font-weight: 600; color: #212529; }
  .form-input { width: 100%; border: 1px solid #e9ecef; border-radius: 10px; padding: 0.65rem 0.75rem; }
  .submit-btn { width: 100%; border: none; border-radius: 12px; padding: 0.75rem 1rem; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; font-weight: 600; }
  .cancel-link { display: inline-block; margin-top: 0.75rem; color: #6c757d; text-decoration: none; }
  .cancel-link:hover { text-decoration: underline; }
</style>
{% endblock %} 