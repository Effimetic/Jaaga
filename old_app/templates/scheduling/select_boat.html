{% extends "base.html" %}

{% block title %}{% if edit_mode %}Edit Schedule - Step 2{% else %}Select Boat - Step 2{% endif %}{% endblock %}

{% block content %}
<!-- Edit mode variables -->
{% set edit_mode = edit_mode or false %}
{% set edit_schedule_id = edit_schedule_id or '' %}
{% set preloaded_boat_id = preloaded_boat_id or '' %}

<div class="mobile-app-container">
  <div class="page-header">
    <div class="header-content">
      <h4 class="page-title"><i class="fas fa-{% if edit_mode %}edit{% else %}ship{% endif %} me-2"></i>{% if edit_mode %}Edit Schedule{% else %}Select Boat{% endif %}</h4>
      <p class="page-subtitle">{% if edit_mode %}Step 2 of 5 • Update boat selection{% else %}Step 2 of 4 • {{ schedule_date.strftime('%b %d, %Y') }}{% endif %}</p>
    </div>
    <a href="{% if edit_mode %}{{ url_for('scheduling.create_schedule') }}{% else %}{{ url_for('scheduling.create_schedule') }}{% endif %}" class="add-btn" title="Back"><i class="fas fa-arrow-left"></i></a>
  </div>

  <div class="form-card">
    <form id="boatForm">
      <div class="form-group">
        <label for="boatSelect" class="form-label"><i class="fas fa-ship me-2"></i>Available Boats</label>
        <select class="form-input" id="boatSelect" name="boat_id" required title="Available boats">
          <option value="">Select a boat</option>
          {% for boat in boats %}
          <option value="{{ boat.id }}" data-seats="{{ boat.total_seats }}" {% if edit_mode and preloaded_boat_id|string == boat.id|string %}selected{% endif %}>{{ boat.name }} ({{ boat.total_seats }} seats)</option>
          {% endfor %}
        </select>
        <small class="text-muted">{% if edit_mode %}Update the boat for your schedule{% else %}Choose a boat from your fleet{% endif %}</small>
      </div>
      <button type="submit" class="submit-btn"><i class="fas fa-arrow-right me-2"></i>{% if edit_mode %}Continue to seat configuration{% else %}Continue to seat configuration{% endif %}</button>
      <a href="{% if edit_mode %}{{ url_for('scheduling.create_schedule') }}{% else %}{{ url_for('scheduling.create_schedule') }}{% endif %}" class="cancel-link"><i class="fas fa-arrow-left me-2"></i>{% if edit_mode %}Back to date{% else %}Back to date{% endif %}</a>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('boatForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const boatId = document.getElementById('boatSelect').value;
    const button = document.querySelector('button[type="submit"]');
    const originalText = button.innerHTML;
    
    if (!boatId) {
        showAlert('Please select a boat', 'warning');
        return;
    }
    
    showLoading(button);
    
    try {
        const response = await fetch('/schedules/select-boat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ boat_id: boatId })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert(data.message, 'success');
            setTimeout(() => {
                window.location.href = data.redirect;
            }, 1500);
        } else {
            showAlert(data.error || 'Failed to select boat', 'danger');
        }
    } catch (error) {
        showAlert('Network error. Please try again.', 'danger');
    } finally {
        hideLoading(button, originalText);
    }
});
</script>

<style>
  .mobile-app-container { max-width: 600px; margin: 0 auto; padding: 1rem; }
  .page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding: 1rem; background: #fff; border: 1px solid #e9ecef; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
  .header-content { flex: 1; }
  .page-title { margin: 0; font-size: 1.125rem; font-weight: 600; color: #212529; }
  .page-subtitle { margin: 0.25rem 0 0; color: #6c757d; font-size: 0.85rem; }
  .add-btn { width: 40px; height: 40px; background: #f1f3f5; color: #495057; display: inline-flex; align-items: center; justify-content: center; border-radius: 10px; text-decoration: none; }
  .form-card { background: #fff; border: 1px solid #e9ecef; border-radius: 16px; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
  .form-group { display: flex; flex-direction: column; gap: 0.4rem; margin-bottom: 1rem; }
  .form-label { font-weight: 600; color: #212529; }
  .form-input { width: 100%; border: 1px solid #e9ecef; border-radius: 10px; padding: 0.65rem 0.75rem; }
  .submit-btn { width: 100%; border: none; border-radius: 12px; padding: 0.75rem 1rem; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; font-weight: 600; }
  .cancel-link { display: inline-block; margin-top: 0.75rem; color: #6c757d; text-decoration: none; }
  .cancel-link:hover { text-decoration: underline; }
</style>
{% endblock %} 