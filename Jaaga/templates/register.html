{% extends "base.html" %}

{% block title %}Register - Nashath Booking{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                        <h2 class="fw-bold">Create Account</h2>
                        <p class="text-muted">Join Nashath Booking to start booking speed boat tickets</p>
                    </div>
                    
                    <form id="registerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Full Name *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-user"></i>
                                    </span>
                                    <input type="text" class="form-control" id="name" name="name" 
                                           placeholder="John Doe" required>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone Number *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-phone"></i>
                                    </span>
                                    <input type="tel" class="form-control" id="phone" name="phone" 
                                           placeholder="+960 123 4567" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" class="form-control" id="email" name="email" 
                                       placeholder="john@example.com">
                            </div>
                            <div class="form-text">Optional - for booking confirmations and updates</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="role" class="form-label">Account Type *</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-users"></i>
                                </span>
                                <select class="form-select" id="role" name="role" required>
                                    <option value="">Select account type</option>
                                    <option value="public">Public User - Book tickets for personal travel</option>
                                    <option value="agent">Entity/Agent - Book tickets on credit for clients</option>
                                    <option value="owner">Boat Owner - Manage boats and schedules</option>
                                </select>
                            </div>
                            <div class="form-text">Choose the account type that best describes your needs</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Account Types:</strong>
                            <ul class="mb-0 mt-2">
                                <li><strong>Public User:</strong> Book and pay for trips using MVR or USD</li>
                                <li><strong>Entity/Agent:</strong> Book on credit, no upfront payment required</li>
                                <li><strong>Boat Owner:</strong> Manage boats, configure seating, create schedules</li>
                            </ul>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3" id="registerBtn">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </form>
                    
                    <hr class="my-4">
                    
                    <div class="text-center">
                        <p class="mb-0">Already have an account? 
                            <a href="{{ url_for('main.login') }}" class="text-decoration-none">Login here</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('name').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        role: document.getElementById('role').value
    };
    
    const button = document.getElementById('registerBtn');
    const originalText = button.innerHTML;
    
    // Validation
    if (!formData.name) {
        showAlert('Please enter your full name', 'danger');
        return;
    }
    
    if (!formData.phone) {
        showAlert('Please enter your phone number', 'danger');
        return;
    }
    
    if (!formData.role) {
        showAlert('Please select an account type', 'danger');
        return;
    }
    
    showLoading(button);
    
    try {
        const response = await fetch('/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert(data.message, 'success');
            setTimeout(() => {
                window.location.href = data.redirect;
            }, 1500);
        } else {
            showAlert(data.error || 'Registration failed', 'danger');
        }
    } catch (error) {
        showAlert('Network error. Please try again.', 'danger');
    } finally {
        hideLoading(button, originalText);
    }
});

// Auto-format phone number
document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 0) {
        if (value.startsWith('960')) {
            value = '+960 ' + value.substring(3);
        } else if (value.startsWith('0')) {
            value = '+960 ' + value.substring(1);
        } else {
            value = '+960 ' + value;
        }
    }
    e.target.value = value;
});

// Role selection info
document.getElementById('role').addEventListener('change', function(e) {
    const role = e.target.value;
    const infoDiv = document.querySelector('.alert-info ul');
    
    if (role === 'public') {
        infoDiv.innerHTML = '<li><strong>Public User:</strong> Book and pay for trips using MVR or USD. Payment required 24 hours before departure.</li>';
    } else if (role === 'agent') {
        infoDiv.innerHTML = '<li><strong>Entity/Agent:</strong> Book on credit, no upfront payment required. Manage client bookings.</li>';
    } else if (role === 'owner') {
        infoDiv.innerHTML = '<li><strong>Boat Owner:</strong> Manage boats, configure seating, create schedules, and receive payments.</li>';
    } else {
        infoDiv.innerHTML = '<li><strong>Public User:</strong> Book and pay for trips using MVR or USD</li><li><strong>Entity/Agent:</strong> Book on credit, no upfront payment required</li><li><strong>Boat Owner:</strong> Manage boats, configure seating, create schedules</li>';
    }
});
</script>
{% endblock %} 